# Artifact A75: DCE - Text Area Component A-B-C Test Plan
# Date Created: C179
# Author: AI Model & Curator
# Updated on: C180 (Acknowledge word-wrap limitation)

- **Key/Value for A0:**
- **Description:** A plan to create a test harness for the `NumberedTextarea` component to diagnose and fix persistent scrolling and alignment bugs.
- **Tags:** plan, process, debugging, troubleshooting, ui, ux, react

## 1. Overview & Goal

The `NumberedTextarea` component, used for the "Cycle Context" and "Ephemeral Context" fields in the Parallel Co-Pilot Panel, has been a persistent source of UI bugs across multiple cycles (C1, C2, C3, C167, C174). The primary issues are a lack of synchronized scrolling between the line numbers and the text content, and a misalignment of the cursor and text selection, making the component difficult to use.

The goal of this plan is to apply the "Original-A-B-C" testing strategy, as defined in `A51`, to definitively diagnose and resolve these issues. We will create a test harness within the PCPP that allows for parallel testing of the original component and three new, isolated test components, each attempting a different solution.

## 2. Known Limitation: Word-Wrap Line Numbering

As of Cycle 4, it has been observed that the current architecture of the `NumberedTextarea` (and all proposed test variants) does not correctly handle line numbering for word-wrapped text. The component counts lines based on newline characters (`\n`), not on how the text visually wraps in the view. This means a single line of text that wraps into three visual lines will only get one line number.

**This is a known limitation.** A true fix for this requires a significantly more complex architecture, likely involving rendering text into a hidden element and measuring the resulting line boxes. For the current development phase, the priority is to fix the blocking usability bugs (scrolling, focus, performance). The word-wrap numbering issue will be deferred to a future cycle dedicated to advanced component architecture.

## 3. The Strategy

### 3.1. Test Harness Implementation
The main `parallel-copilot.view/view.tsx` component will be refactored to include a new "Test Harness" mode.
-   A new state, `activeTestView`, will control which view is active: `'Original'`, `'TestA'`, `'TestB'`, or `'TestC'`.
-   A simple tab bar UI will be added to switch between these views.
-   The "Original" view will render the current, fully-featured PCPP layout.
-   The other views will render the isolated test components.

### 3.2. Isolated Test Components
Three new test components will be created to isolate and test specific variables.

-   **Test A (`TestPane1.tsx`): Synchronized Scrolling**
    -   **Hypothesis:** The scrolling is failing because the `onScroll` event is not being correctly used to synchronize the `scrollTop` of the line number gutter and the text area.
    -   **Implementation:** This component will feature a barebones `textarea` next to a `div` for line numbers. It will implement a robust `onScroll` handler that programmatically sets the `scrollTop` of the line number gutter, with extensive logging to confirm the event is firing and the values are changing.

-   **Test B (`TestPane2.tsx`): Pixel-Perfect Alignment**
    -   **Hypothesis:** The cursor and selection are misaligned due to subtle differences in CSS properties (`font-family`, `font-size`, `line-height`, `padding`, `box-sizing`) between the transparent `textarea` and the underlying `div` that displays the highlighted text.
    -   **Implementation:** This component will implement the overlay approach. It will meticulously ensure that every single font and box-model CSS property is identical across both elements. It will contain no complex logic, only the minimal structure needed to test for visual alignment.

-   **Test C (`TestPane3.tsx`): Combined & Cleaned Solution**
    -   **Hypothesis:** A clean implementation combining the lessons from Test A and Test B will provide a fully functional component.
    -   **Implementation:** This component will integrate the synchronized scrolling from Test A with the pixel-perfect styling from Test B into a new, clean version of the `NumberedTextarea` component, free from any other complex logic from the main view.

## 4. Cleanup Process
Once a working pattern is identified in a test component:
1.  **Codify Findings:** The successful pattern and the root cause of the failure will be documented in `A11. DCE - Regression Case Studies`.
2.  **Integrate Solution:** The original `NumberedTextarea.tsx` component will be refactored to use the successful pattern.
3.  **Remove Test Artifacts:** The test harness UI and the `TestPane*.tsx` component files will be removed from the project.