# Artifact A8: DCE - Phase 1 - Selection Sets Feature Plan
# Date Created: Cycle 11
# Author: AI Model

- **Description:** A plan outlining the user stories, UI/UX, and technical implementation for saving and loading different sets of selected files (selection profiles).
- **Tags:** feature plan, selection sets, profiles, context management, phase 1

## 1. Overview & Goal

The goal of the "Selection Sets" feature is to address the user feedback from Cycle 11 regarding the need to save and switch between different file selections. Users often work on multiple tasks or projects concurrently, each requiring a different context. Manually re-selecting dozens of files each time they switch tasks is tedious and inefficient. This feature will allow users to save a named "set" of their current selections and quickly load it back later.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| US-01 | **Save Current Selection** | As a developer, I want to save my currently checked files as a named set, so I don't have to re-select them manually when I switch tasks. | - A UI element (e.g., button or menu item) exists to "Save current selection". <br> - Clicking it prompts me to enter a name for the selection set. <br> - After providing a name, the current list of selected file paths is saved. <br> - I receive a confirmation that the set was saved. |
| US-02 | **Load a Saved Selection** | As a developer, I want to load a previously saved selection set, so I can quickly restore a specific context. | - A UI element (e.g., a dropdown menu) lists all saved selection sets by name. <br> - Selecting a set from the list immediately updates the file tree, checking all the files and folders from that set. <br> - Any previously checked files that are not part of the loaded set become unchecked. |
| US-03 | **Delete a Saved Selection** | As a developer, I want to delete a selection set that I no longer need, so I can keep my list of saved sets clean. | - A UI element exists to manage or delete saved sets. <br> - I can select a set to delete from a list. <br> - I am asked to confirm the deletion. <br> - Upon confirmation, the set is removed from the list of saved sets. |

## 3. Proposed UI/UX

The most efficient place for this functionality is within the `view-header` of our Context Chooser panel.

1.  **Header Controls:**
    *   A dropdown menu will be added to the header, perhaps next to the "Flatten Context" button.
    *   The dropdown's default text will be "Selection Sets".
    *   The dropdown will contain:
        *   A list of currently saved selection sets.
        *   A separator.
        *   An action item: "Save Current Selection..."
        *   An action item: "Manage Selections..."

2.  **Saving a Set:**
    *   Clicking "Save Current Selection..." will trigger a VS Code input box (`vscode.window.showInputBox`).
    *   The user will enter a name (e.g., "API Feature", "Frontend Refactor").
    *   On submission, the backend saves the current `selectedFiles` array under that name.

3.  **Loading a Set:**
    *   Clicking on a saved set's name in the dropdown will immediately trigger an IPC message to the frontend with the array of file paths for that set.
    *   The frontend will update its `selectedFiles` state, causing the tree to re-render with the new selections.

4.  **Managing Sets:**
    *   Clicking "Manage Selections..." will open a Quick Pick list (`vscode.window.showQuickPick`).
    *   The list will show all saved sets. Each item will have a trash can icon next to it.
    *   Selecting an item will prompt for confirmation and then delete the set.

## 4. Technical Implementation Plan

1.  **Data Storage:**
    *   Selection sets will be stored in the VS Code `workspaceState`. This is a key-value store specific to the current workspace.
    *   A single key, e.g., `dce.selectionSets`, will hold an object where keys are the set names and values are the `string[]` of absolute file paths.
    *   Example: `{ "API Feature": ["/path/to/api.ts", "/path/to/service.ts"], "UI Bugfix": ["/path/to/component.tsx"] }`

2.  **IPC Channels (New/Updated):**
    *   **Client -> Server:**
        *   `RequestSelectionSets`: Sent on view load to populate the dropdown.
        *   `SaveSelectionSet`: Sent with `{ name: string, paths: string[] }`.
        *   `DeleteSelectionSet`: Sent with `{ name: string }`.
    *   **Server -> Client:**
        *   `SendSelectionSets`: Sent with the entire map of saved sets.
        *   `LoadSelectionSet`: Sent with a single `{ paths: string[] }` to update the view's state.

3.  **Backend Logic (`on-message.ts` & new Service):**
    *   Create a new `SelectionService.ts` to encapsulate all logic for getting, setting, and deleting sets from `workspaceState`.
    *   Update `on-message.ts` to handle the new IPC messages and call the appropriate methods in `SelectionService`.
    *   The `LoadSelectionSet` message will be sent from the backend to the client after a user selects a set to load from the UI (which would be handled by a command). A command would be better for showing the Quick Pick UI.

4.  **Frontend Logic (`view.tsx`):**
    *   Add state to store the map of selection sets: `const [selectionSets, setSelectionSets] = useState({});`
    *   On mount, send `RequestSelectionSets`.
    *   Implement an effect to listen for `SendSelectionSets` and update the local state.
    *   Implement an effect to listen for `LoadSelectionSet` and call `setSelectedFiles()` with the new paths.
    *   Render the new dropdown menu in the header.
    *   Implement the `onClick` handler for "Save Current Selection..." which will trigger the `SaveSelectionSet` message.