# Artifact A103: DCE - Consolidated Response UI Plan
# Date Created: C73
# Author: AI Model & Curator
# Updated on: C74 (Refine UI to keep tabs visible during generation)

- **Key/Value for A0:**
- **Description:** Details the plan to consolidate the response generation UI into the main PCPP view. This involves showing the progress display in the main content area when the current cycle is in a "generating" state, while keeping the response tabs visible. Also includes making the Ephemeral Context collapsible.
- **Tags:** feature plan, ui, ux, workflow, refactor, state management

## 1. Vision & Goal

The current workflow for generating responses involves a jarring context switch. The user clicks "Generate responses," and the entire UI is replaced by a separate "Generation Progress" view. To return to the main panel, the user must wait for completion or navigate away and lose the progress view.

The goal of this refactor is to create a more seamless, integrated experience. The response generation UI will now be displayed *within* the main Parallel Co-Pilot Panel (PCPP) view itself. This is achieved by making the UI state-driven: if the currently selected cycle is in a "generating" state, the progress display is shown; otherwise, the standard response tabs are shown.

## 2. User Flow (C74 Refinement)

1.  **User Action:** The user is on Cycle `N` and clicks `Generate responses`.
2.  **Backend Action:** The backend creates a new placeholder Cycle `N+1` with `status: 'generating'` and notifies the frontend.
3.  **UI Navigation:** The frontend automatically navigates to the new Cycle `N+1`.
4.  **Conditional Rendering:** The main PCPP view component loads the data for Cycle `N+1`. It sees that `status` is `'generating'`.
5.  **New UI State:**
    *   The `ResponseTabs` component **remains visible**. The tabs for the generating responses will show a loading indicator.
    *   The main content area *below* the tabs, which would normally show the `ResponsePane`, now renders the `GenerationProgressDisplay`. The user sees the progress bars for the new cycle they are on.
    *   As individual responses complete, their loading indicators on the tabs disappear. The user can click on a completed response's tab to switch the view from the `GenerationProgressDisplay` to the `ResponsePane` for that specific tab, allowing them to review it while others are still generating.
6.  **Completion:** When all LLM responses are complete, the backend updates the status of Cycle `N+1` to `'complete'`. The frontend receives this update, and the default view for all tabs becomes the `ResponsePane`.

## 3. Additional UI Refinements

-   **Collapsible Ephemeral Context:** To de-clutter the UI, the "Ephemeral Context" text area, which is used less frequently, will now be in a collapsible section. It will be collapsed by default for new cycles. This state will be persisted per-cycle.

## 4. Technical Implementation Plan

1.  **Remove `activeView` State:**
    *   **`view.tsx`:** The `const [activeView, setActiveView] = useState<'main' | 'progress'>('main');` state and all associated logic will be removed.
    *   **`vscode-webview.d.ts`:** The `pcppActiveView` property will be removed from the `ViewState` interface.

2.  **Implement Conditional Rendering (`view.tsx`):**
    *   The main render logic will be updated:
        ```jsx
        // Inside the App component's return statement
        <ResponseTabs {...props} />
        {currentCycle?.status === 'generating' ? (
            <GenerationProgressDisplay {...props} />
        ) : (
            <>
                <WorkflowToolbar {...props} />
                <div className="tab-content">
                    <ResponsePane {...props} />
                </div>
            </>
        )}
        ```

3.  **Make Ephemeral Context Collapsible:**
    *   **`pcpp.types.ts`:** Add `isEphemeralContextCollapsed?: boolean;` to the `PcppCycle` interface.
    *   **`history.service.ts`:** In the default cycle object, set `isEphemeralContextCollapsed: true`.
    *   **`ContextInputs.tsx`:**
        *   Add a new state for the collapsed state, initialized from props.
        *   Wrap the Ephemeral Context `textarea` and its label in a `CollapsibleSection` component.
    *   **`view.tsx`:** Manage the collapsed state and pass it down to `ContextInputs`, ensuring it's included in the `saveCurrentCycleState` payload.
    *   **`view.scss`:** Add styling for the new collapsible section within the `context-inputs` container.