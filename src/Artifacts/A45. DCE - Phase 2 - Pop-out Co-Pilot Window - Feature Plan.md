# Artifact A45: DCE - Phase 2 - Pop-out Co-Pilot Window - Feature Plan
# Date Created: C76
# Author: AI Model

- **Key/Value for A0:**
- **Description:** Outlines the technical strategy to allow the Parallel Co-Pilot panel to be "popped out" into a separate window by re-implementing it as a main editor WebviewPanel.
- **Tags:** feature plan, phase 2, pop-out, window, webview, ux

## 1. Overview & Goal

The Parallel Co-Pilot panel is designed for intensive, side-by-side comparison of code, a task that benefits greatly from maximum screen real estate. Many developers use multiple monitors and would prefer to move this panel to a secondary display. The goal of this feature is to enable the user to "pop out" the Parallel Co-Pilot panel into its own floating window.

## 2. Problem & Proposed Solution

A direct `popOut()` API for a sidebar webview does not exist in the VS Code extension API. The most robust and user-friendly way to achieve this is to leverage a native VS Code feature: users can drag any editor tab into its own floating window.

Therefore, the proposed solution is to **re-architect the Parallel Co-Pilot from a sidebar view (`WebviewViewProvider`) into a main editor view (`WebviewPanel`)**.

### 2.1. User Experience Flow

1.  The user clicks a "Pop-out" icon in the Parallel Co-Pilot header (or runs a command from the palette).
2.  Instead of opening in the sidebar, the Parallel Co-Pilot panel opens as a new tab in the main editor group.
3.  The user can then click and drag this tab out of the main VS Code window, and it will become its own floating window, which can be moved to another monitor.

## 3. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-WIN-01 | **Open Co-Pilot in Main Editor**| As a developer, I want a command or button to open the Parallel Co-Pilot panel in a main editor tab, so I have more horizontal space to view and compare responses. | - A "Pop-out" icon or similar button exists in the Co-Pilot UI. <br> - Clicking it closes the sidebar view (if open) and opens a new editor tab containing the full Co-Pilot UI. <br> - The state of the panel (e.g., current cycle, tab content) is preserved during this transition. |
| P2-WIN-02 | **Move Co-Pilot to New Window** | As a developer with multiple monitors, after opening the Co-Pilot in an editor tab, I want to drag that tab out of my main VS Code window to turn it into a separate, floating window, so I can place it on my second monitor. | - The Co-Pilot editor tab behaves like any other editor tab. <br> - It can be dragged to create new editor groups or dragged outside the main window to create a new floating window. |

## 4. Technical Implementation Plan

This is a significant architectural change.

1.  **Remove Sidebar Contribution (`package.json`):**
    *   The `dce-parallel-copilot` entry in `contributes.viewsContainers.activitybar` will be removed.
    *   The corresponding entry in `contributes.views` will also be removed.

2.  **Create a `WebviewPanel` (`extension.ts` or a new provider file):**
    *   The logic that currently lives in the `resolveWebviewView` method of our `WebviewViewProvider` will be moved.
    *   A new command, `dce.openParallelCopilot`, will be registered.
    *   When this command is executed, it will call `vscode.window.createWebviewPanel`.
    *   This function creates a webview in an editor tab. We will need to configure its `viewType`, `title`, and `column`.
    *   The logic for setting the webview's HTML, options, and message handlers will be nearly identical to the current implementation.

3.  **State Management:**
    *   A key challenge is managing the panel's state. Since `createWebviewPanel` can be called multiple times, we need to ensure we don't create duplicate panels. The implementation should check if a panel already exists and, if so, simply reveal it (`panel.reveal()`).
    *   The state (tab content, cycle number) must be managed in a backend service so it can be restored if the panel is closed and reopened.

4.  **UI Trigger:**
    *   The "Pop-out" button in the (now legacy) sidebar view will trigger the `dce.openParallelCopilot` command.
    *   We can also add a command to the Command Palette for direct access.