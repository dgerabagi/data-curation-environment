# Artifact A13: DCE - Phase 1 - Right-Click Context Menu
# Date Created: Cycle 19
# Author: AI Model

- **Key/Value for A0:**
- **Description:** A plan for implementing standard file explorer context menu actions (e.g., Rename, Delete, Copy Path) in the custom file tree.
- **Tags:** feature plan, context menu, right-click, file operations, ux, phase 1

## 1. Overview & Goal

To enhance the user experience and make the Data Curation Environment's file tree a more complete replacement for the native VS Code explorer, this feature will add a standard right-click context menu. The goal is to provide essential file management operations directly within our extension's view, reducing the need for users to switch back to the native explorer for common tasks.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| US-01 | **Copy Path** | As a user, I want to right-click a file or folder and copy its absolute or relative path to my clipboard, so I can easily reference it elsewhere. | - Right-clicking a node in the file tree opens a context menu. <br> - The menu contains "Copy Path" and "Copy Relative Path" options. <br> - Selecting an option copies the corresponding path string to the system clipboard. |
| US-02 | **Rename File/Folder** | As a user, I want to right-click a file or folder and rename it, so I can correct mistakes or refactor my project structure. | - The context menu contains a "Rename" option. <br> - Selecting it turns the file/folder name into an editable input field. <br> - Pressing Enter or clicking away saves the new name. <br> - The underlying file/folder is renamed on the file system. <br> - The file tree updates to reflect the change. |
| US-03 | **Delete File/Folder** | As a user, I want to right-click a file or folder and delete it, so I can remove unnecessary files from my project. | - The context menu contains a "Delete" option. <br> - Selecting it shows a confirmation dialog to prevent accidental deletion. <br> - Upon confirmation, the file or folder (and its contents, recursively) is moved to the trash/recycling bin. <br> - The file tree updates to reflect the change. |
| US-04 | **Reveal in Explorer** | As a user, I want to right-click a file or folder and have it revealed in the native OS file explorer, so I can interact with it outside of VS Code. | - The context menu contains a "Reveal in File Explorer" (or "Reveal in Finder" on macOS) option. <br> - Selecting it opens the parent directory of the item in the operating system's default file manager with the item selected. |

## 3. Technical Implementation Plan

1.  **Frontend (`FileTree.tsx`, new `ContextMenu.tsx`):**
    *   Create a new reusable `ContextMenu.tsx` component that can be triggered by an `onContextMenu` event.
    *   In `FileTree.tsx`, add an `onContextMenu` event handler to each file/folder item wrapper.
    *   This handler will prevent the default browser menu, get the file node's data, and render the `ContextMenu` component at the cursor's position with the appropriate options.
    *   For "Rename", the component will need to manage local state to switch between displaying the name and an `<input>` field.

2.  **IPC Channels (`channels.enum.ts`, `channels.type.ts`):**
    *   New `ClientToServerChannel` messages will be required for each action that needs backend interaction:
        *   `RequestFileRename`: Body `{ oldPath: string, newPath: string }`
        *   `RequestFileDelete`: Body `{ path: string }`
        *   `RequestRevealInExplorer`: Body `{ path: string }`
        *   `RequestCopyPath`: Body `{ path: string, relative: boolean }`

3.  **Backend (`fs.service.ts`, `on-message.ts`):**
    *   Update `on-message.ts` to handle the new IPC messages and call corresponding methods in the `FSService`.
    *   **Rename:** Implement a method that uses `vscode.workspace.fs.rename(oldUri, newUri)`.
    *   **Delete:** Implement a method that uses `vscode.workspace.fs.delete(uri, { recursive: true, useTrash: true })`. The `useTrash` option is crucial for data safety.
    *   **Reveal:** Implement a method that executes the built-in VS Code command: `vscode.commands.executeCommand('revealInExplorer', uri)`.
    *   **Copy Path:** Implement a method that uses `vscode.env.clipboard.writeText()` to put the absolute or relative path (calculated using `path.relative`) on the clipboard.
    *   After any file system modification (rename, delete), the backend method **must** call `this.triggerRefresh()` to ensure the UI is updated automatically.