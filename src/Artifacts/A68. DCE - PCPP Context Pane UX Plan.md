# Artifact A68: DCE - PCPP Context Pane UX Plan
# Date Created: C167
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** A plan to enhance the UX of the cycle context and ephemeral context text areas with features like token counts and line numbers.
- **Tags:** feature plan, ui, ux, pcpp, context

## 1. Overview & Goal

The "Cycle Context" and "Ephemeral Context" text areas in the Parallel Co-Pilot Panel are crucial for prompt engineering, but their current implementation as basic `<textarea>` elements lacks key features. The goal of this plan is to significantly enhance their usability by adding token counts, line numbers, and persistent resizing.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-CTX-01 | **See Context Token Count** | As a developer, I want to see a live token count for the Cycle Context and Ephemeral Context fields, so I can manage the size of my prompt effectively. | - Below each text area, a label displays the approximate token count of its content. <br> - The count updates in real-time as the user types. |
| P2-CTX-02 | **See Line Numbers** | As a developer, I want to see line numbers in the context text areas, so I can easily reference specific parts of a long context or error log. | - A line number gutter is displayed to the left of the text input area. <br> - The line numbers scroll in sync with the text content. |
| P2-CTX-03 | **Persistent Resizing** | As a developer, when I resize the height of a context text area, I want it to remain that size when I switch to another response tab and back, so I don't lose my layout preferences. | - The `height` of each text area is stored as part of the panel's state. <br> - When the user resizes a text area, its new height is saved. <br> - When the panel re-renders, the text areas are restored to their saved heights. |

## 3. Technical Implementation Plan

### 3.1. Token Counts
-   **State:** Add new state variables to `view.tsx`: `cycleContextTokens` and `ephemeralContextTokens`.
-   **UI:** Add `<span>` elements below each text area to display these state values.
-   **Logic:** The `onChange` handlers for the text areas will be updated to calculate the token count (`e.target.value.length / 4`) and update the corresponding token count state.

### 3.2. Line Numbers & Resizing (Combined Solution)
-   **Problem:** A standard HTML `<textarea>` does not support a line number gutter. Persisting its height after a manual resize (dragging the corner) is also not straightforward.
-   **Solution:** Replace the `<textarea>` elements with a custom "editor" component built from `<div>` elements. This is a common pattern for creating simple code editors.
-   **Implementation:**
    1.  **New Component (`SimpleEditor.tsx`):** Create a new reusable component that takes `value` and `onChange` as props.
    2.  **Structure:** The component will consist of a wrapper `div` containing two child `div`s: one for the line numbers and one for the text content.
    3.  **Line Numbers:** The line number `div` will render a list of numbers based on the number of newlines in the `value` prop.
    4.  **Text Input:** The content `div` will have the `contentEditable="true"` attribute, making it a live text editor. Its `onInput` event will be used to call the `onChange` prop.
    5.  **Synchronization:** Both `div`s will be styled to ensure their line heights and fonts match, and they will scroll together.
    6.  **Resizable Handle:** A draggable handle will be added to the bottom of the main wrapper. `onMouseDown`, `onMouseMove`, and `onMouseUp` handlers will be used to track the drag gesture and update a `height` prop, which will be stored in the main `view.tsx` state to ensure persistence.