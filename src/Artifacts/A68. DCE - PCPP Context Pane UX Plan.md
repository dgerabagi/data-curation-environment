# Artifact A68: DCE - PCPP Context Pane UX Plan
# Date Created: C167
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** A plan to enhance the UX of the cycle context and ephemeral context text areas with features like token counts and line numbers.
- **Tags:** feature plan, ui, ux, pcpp, context

## 1. Overview & Goal

The "Cycle Context" and "Ephemeral Context" text areas in the Parallel Co-Pilot Panel are crucial for prompt engineering, but their current implementation as basic `<textarea>` elements lacks key features. The goal of this plan is to significantly enhance their usability by adding token counts, line numbers, and persistent resizing.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-CTX-01 | **See Context Token Count** | As a developer, I want to see a live token count for the Cycle Context and Ephemeral Context fields, so I can manage the size of my prompt effectively. | - Below each text area, a label displays the approximate token count of its content. <br> - The count updates in real-time as the user types. |
| P2-CTX-02 | **See Line Numbers** | As a developer, I want to see line numbers in the context text areas, so I can easily reference specific parts of a long context or error log. | - A line number gutter is displayed to the left of the text input area. <br> - The line numbers scroll in sync with the text content. |
| P2-CTX-03 | **Persistent Resizing** | As a developer, when I resize the height of a context text area, I want it to remain that size when I navigate between cycles, so I don't lose my layout preferences. | - The `height` of each text area is stored as part of the `PcppCycle` state. <br> - When the user resizes a text area, its new height is saved. <br> - When the panel re-renders or a cycle is loaded, the text areas are restored to their saved heights. |

## 3. Technical Implementation Plan

### 3.1. Token Counts
-   **State:** Add new state variables to `view.tsx`: `cycleContextTokens` and `ephemeralContextTokens`.
-   **UI:** Add `<span>` elements below each text area to display these state values.
-   **Logic:** The `onChange` handlers for the text areas will be updated to calculate the token count (`e.target.value.length / 4`) and update the corresponding token count state.

### 3.2. Line Numbers & Resizing
-   **New Component (`NumberedTextarea.tsx`):**
    -   Create a new reusable component that renders a `textarea` alongside a synchronized `div` for line numbers.
    -   This component will manage its own internal state for line count based on the `value` prop.
    -   It will include a draggable handle at the bottom. `onMouseDown`, `onMouseMove`, and `onMouseUp` handlers will be used to track the drag gesture.
    -   It will call an `onHeightChange` prop function with the new height, allowing the parent to manage the state.
-   **Integration (`view.tsx`):**
    -   Replace the existing `<textarea>` elements with the new `<NumberedTextarea>` component.
    -   **State:** Add `cycleContextHeight` and `ephemeralContextHeight` to the component's state and to the `PcppCycle` type definition.
    -   The `onHeightChange` prop of the new component will be wired to update these state variables, which will be persisted via the existing debounced save mechanism.