# Artifact A97: DCE - vLLM Response Progress UI Plan
# Date Created: C48
# Author: AI Model & Curator
# Updated on: C76 (Add requirement for per-response timers)

- **Key/Value for A0:**
- **Description:** A plan and textual mockup for a UI to display the progress of incoming vLLM responses, including color-coded progress bars, status indicators, timers, and a manual "View Responses" button.
- **Tags:** feature plan, ui, ux, vllm, progress indicator, metrics, streaming, sse

## 1. Vision & Goal

Generating multiple, large AI responses can take a significant amount of time. To improve the user experience, it's critical to provide clear, real-time feedback that the system is working and to show the progress of the generation. The goal of this feature is to create a dedicated UI that appears during response generation, displaying progress bars, status indicators, performance metrics, and timing information for each parallel response.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P3-PROG-01 | **See Generation Progress** | As a user, when I click "Generate responses," I want a UI to immediately appear that shows me the progress of each response being generated, so I know the system is working and not frozen. | - When generation starts, a progress display UI is shown. <br> - It contains a separate progress bar for each of the `N` requested responses. <br> - Each progress bar updates in real-time as tokens are received. |
| P3-PROG-02 | **See Performance Metrics** | As a user, I want to see a live "tokens per second" metric during generation, so I can gauge the performance of the LLM backend. | - The progress UI displays a "Tokens/sec" value. <br> - This value is calculated and updated periodically throughout the generation process. |
| P3-PROG-03 | **Understand Progress Bar**| As a user, I want the progress bar to be color-coded so I can understand the allocation of tokens for the prompt versus the generated response. | - The progress bar is a stacked bar with multiple colors. <br> - One color represents the "thinking" (prompt) tokens. <br> - A second color represents the currently generated response tokens. <br> - **(C69 Update)** A third color (blue) represents the remaining, unused tokens up to the model's maximum. |
| P3-PROG-04 | **See Response Status** | As a user, I want to see the status of each individual response (e.g., "Thinking...", "Generating...", "Complete"), so I know what the system is doing. | - A text indicator next to each progress bar shows its current status. <br> - The indicator is animated during the "Thinking" and "Generating" phases. <br> - When a response is complete, the "unused" portion of its progress bar changes color to signify completion. |
| P3-PROG-05 | **See Unused Tokens** | As a user, once a response is complete, I want to see how many tokens were left unused, so I can understand how much headroom the model had. | - After a response's status changes to "Complete", a text element appears showing the count of unused tokens. |
| P3-PROG-06 | **Manage Responses** | As a user, I want to sort responses, stop a generation, or re-generate an individual response, so I have more control over the process. | - A sort button cycles through different sort orders. <br> - A "Stop" button for each response cancels its generation. <br> - A "Re-generate" button for each response triggers a new generation just for that slot. |
| P3-PROG-07 | **See Elapsed Time** | As a user, I want to see a timer showing the total elapsed time for the generation, so I can understand how long the process is taking. | - **(C76 Update)** Each response displays its own independent elapsed timer, showing how long that specific generation has taken. |
| P3-PROG-08 | **Review Metrics Before Navigating** | As a user, after all responses are complete, I want to stay on the progress screen to review the final metrics, and then click a button to navigate to the new cycle, so I am in control of the workflow. | - When generation finishes, the UI does not automatically navigate away. <br> - A "View Responses" button appears. <br> - A completion counter (e.g., "4/4 Responses Complete") is displayed. |
| P3-PROG-09 | **Three-Way Sorting** | As a user, I want the sort button to cycle between three states: the default order, sorting by total tokens (thinking + response), and sorting by response tokens only, so I can analyze the results in different ways. | - The sort button cycles through three distinct states. <br> - The UI re-orders the list of responses accordingly. |
| P3-PROG-10 | **Color-Coded Totals** | As a user, I want the total token count display to also be color-coded, so it's consistent with the individual progress bars. | - The numbers in the "Total Tokens" display are color-coded to match the "thinking", "response", and "unused" categories. |

## 3. UI Mockup (Textual Description - C76 Update)

The progress UI will be a dedicated component that is conditionally rendered in the PCPP view when `isGenerating` is true.

```
+----------------------------------------------------------------------+
| Generating Responses... [Sort by Total Tk] Tokens/sec: 1234            |
|----------------------------------------------------------------------|
|                                                                      |
| Resp 1: [blue|green|blue]  80% | 00:35.8 | Status: Gen... [Stop] [Re-gen]|
|         (1k+5.5k/8.1k tk)      |                                      |
| Resp 2: [blue|green|blue]  70% | 00:28.1 | Status: Gen... [Stop] [Re-gen]|
|         (1k+4.7k/8.1k tk)      |                                      |
| Resp 3: [blue|blue      ]  12% | 00:05.2 | Status: Think... [Stop] [Re-gen]|
|         (1k+0k/8.1k tk)        |                                      |
| Resp 4: [blue|green|done] 100% | 00:41.0 | Status: Complete âœ“ [   ] [Re-gen]|
|         (1k+7.1k/8.1k tk)      | Unused: 1,024 tk                     |
|----------------------------------------------------------------------|
| [ 4/4 Responses Complete ]                                           |
+----------------------------------------------------------------------+
```
*   **Header:** The "Sort" button and TPS metric remain.
*   **Per-Response:**
    *   A new, individual timer (e.g., `00:35.8`) is displayed for each response.
    *   Stop/Regen buttons are on the same row as the status.
*   **Footer:** Appears only when generation is complete.

## 4. Technical Implementation Plan (C76 Revision)

1.  **IPC (`channels.type.ts`):** The `GenerationProgress` interface will be updated to include `startTime: number` for each individual response.
2.  **Backend (`llm.service.ts`):** The `generateBatch` method will be updated. When initializing the `progressData` array, it will set `startTime: Date.now()` for each response object.
3.  **Frontend (`GenerationProgressDisplay.tsx`):**
    *   **New Component (`ResponseTimer.tsx`):** A new, small component will be created to manage the timer logic. It will receive a `startTime` prop and use a `useEffect` with `setInterval` to calculate and render the elapsed time. This isolates the timer logic.
    *   **Integration:** `GenerationProgressDisplay.tsx` will map over the `progressData` and render a `ResponseTimer` for each item, passing `p.startTime`. This will result in an independent timer for each response.
4.  **Frontend (`view.tsx`):** No changes are required here for the timer, but it will be updated to handle the new navigation and view-switching logic.