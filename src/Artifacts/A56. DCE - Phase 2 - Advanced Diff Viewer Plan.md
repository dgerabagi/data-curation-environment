# Artifact A56: DCE - Phase 2 - Advanced Diff Viewer Plan
# Date Created: C120
# Author: AI Model & Curator
# Updated on: C121 (Change to side-by-side view with line alignment)

- **Key/Value for A0:**
- **Description:** Details the plan to enhance the integrated diff viewer with background coloring for changes and WinMerge-like navigation controls to jump between differences.
- **Tags:** feature plan, phase 2, ui, ux, diff, navigation

## 1. Overview & Goal

The current diff view is functional but lacks key usability features found in mature diff tools like WinMerge. The goal of this plan is to enhance the diff viewer to provide a much clearer and more efficient user experience. This involves three primary enhancements:
1.  **Side-by-Side Layout:** Displaying the original and modified files in two parallel panes.
2.  **Line Alignment:** Inserting placeholder lines to ensure that common (unchanged) code blocks remain horizontally aligned.
3.  **Navigation Controls:** Adding buttons to allow the user to quickly jump between blocks of differences.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-DIFF-01 | **Colored Side-by-Side Diffs** | As a developer, I want to see a side-by-side view of the original and modified code with a colored background for changed lines, so I can immediately identify changes at a glance. | - The diff view is split into two vertical panes: "Original" on the left, "Modified" on the right. <br> - Lines that exist in the new version but not the old have a distinct background color (e.g., light green) in the right pane. <br> - Lines that exist in the old version but not the new have a different background color (e.g., light red) in the left pane. <br> - Unchanged lines have the standard editor background color in both panes. |
| P2-DIFF-02 | **Aligned Content** | As a developer, when a block of lines is added or removed, I want the other pane to show empty space, so that the lines of code below the change remain horizontally aligned. | - When lines are added in the right pane, an equal number of empty placeholder rows are rendered in the left pane. <br> - When lines are removed from the left pane, an equal number of empty placeholder rows are rendered in the right pane. <br> - This ensures that a common line `X` appears at the same vertical position in both panes, regardless of changes above it. |
| P2-DIFF-03 | **Navigate Between Diffs** | As a developer reviewing a large file, I want "Next Difference" and "Previous Difference" buttons, so I can quickly jump between changed blocks without manually scrolling. | - "Next Difference" (`↓`) and "Previous Difference" (`↑`) buttons are added to the diff viewer's header. <br> - Clicking "Next Difference" scrolls the view to the start of the next block of added or removed lines. <br> - Clicking "Previous Difference" scrolls to the previous block. <br> - The buttons are disabled when at the start or end of the diff list. |

## 3. Technical Implementation Plan

### 3.1. Side-by-Side Diff Logic (`DiffViewer.tsx`)

-   **Processing:** The component will receive the `original` and `modified` strings. It will use the `diffLines` function from the `diff` library.
-   **Data Structure:** It will process the resulting `Change[]` array into a new, unified data structure: `PairedLine[]`, where `PairedLine` is `{ left: DiffLine, right: DiffLine }`.
-   **Algorithm:**
    1.  Iterate through the `Change` array from `diffLines`.
    2.  If a `removed` block is immediately followed by an `added` block, treat this as a "change". Create pairs of lines, padding the shorter block with placeholders so they align.
    3.  If a block is only `removed`, create pairs where the left side has the content and the right side is a placeholder.
    4.  If a block is only `added`, create pairs where the left side is a placeholder and the right side has the content.
    5.  If a block is `common`, create pairs where both sides have the same content.
-   **Rendering:** The component will render two main `div`s (`.diff-pane`). Each pane will contain its own line number gutter and a content area. It will map over the `PairedLine[]` array, rendering the `left` data in the left pane and the `right` data in the right pane for each row.

### 3.2. Styling (`view.scss`)

-   The `.diff-viewer-container` will be a flexbox or grid container to hold the two `.diff-pane` children.
-   Each `.diff-pane` will also be a flexbox container for its line numbers and content.
-   New CSS classes will be used:
    *   `.line.added`: `background-color: var(--vscode-diffEditor-insertedTextBackground);`
    *   `.line.removed`: `background-color: var(--vscode-diffEditor-removedTextBackground);`
    *   `.line.placeholder`: A subtle background color, like `var(--vscode-editor-inactiveSelectionBackground)`, to indicate it's just for alignment.