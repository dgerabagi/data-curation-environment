# Artifact A56: DCE - Phase 2 - Advanced Diff Viewer Plan
# Date Created: C120
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** Details the plan to enhance the integrated diff viewer with background coloring for changes and WinMerge-like navigation controls to jump between differences.
- **Tags:** feature plan, phase 2, ui, ux, diff, navigation

## 1. Overview & Goal

The current diff view is functional but lacks key usability features found in mature diff tools like WinMerge. The goal of this plan is to enhance the diff viewer to provide a much clearer and more efficient user experience. This involves two primary enhancements: adding background coloring to highlight changed lines and implementing navigation controls to allow the user to quickly jump between blocks of differences.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-DIFF-01 | **Colored Diffs** | As a developer, I want to see a colored background for lines that have been added or removed in the diff view, so I can immediately identify the changes at a glance. | - Lines that exist in the new version but not the old have a distinct background color (e.g., light green). <br> - Lines that exist in the old version but not the new have a different background color (e.g., light red). <br> - Unchanged lines have the standard editor background color. |
| P2-DIFF-02 | **Navigate Between Diffs** | As a developer reviewing a large file with scattered changes, I want "Next Difference" and "Previous Difference" buttons, so I can quickly jump between changed blocks without manually scrolling and searching. | - "Next Difference" (`↓`) and "Previous Difference" (`↑`) buttons are added to the diff viewer's header. <br> - Clicking "Next Difference" scrolls the view to the start of the next block of added or removed lines. <br> - Clicking "Previous Difference" scrolls to the previous block. <br> - The buttons are disabled when at the start or end of the diff list. |

## 3. Technical Implementation Plan

### 3.1. Diff Coloring

-   **Component (`DiffViewer.tsx`):**
    1.  The existing logic already uses the `diff` library to get an array of `Change` objects.
    2.  The rendering logic will be updated to apply a CSS class to each line's container `div` based on the `part.added` or `part.removed` properties.
-   **Styling (`view.scss`):**
    1.  New CSS classes (`.line.added`, `.line.removed`) will be created.
    2.  These classes will use VS Code theme variables for the background colors to ensure a native look and feel:
        *   `--vscode-diffEditor-insertedTextBackground` for added lines.
        *   `--vscode-diffEditor-removedTextBackground` for removed lines.

### 3.2. Diff Navigation

-   **Component (`view.tsx`):**
    1.  The main view component will need to manage the state for diff navigation as the `DiffViewer` itself is a more presentational component.
-   **Component (`DiffViewer.tsx`):**
    1.  **Identify Change Locations:** A `useMemo` hook will be added. When the `original` and `modified` props change, it will re-calculate the diff and also identify the line numbers where changes begin. It will store these line numbers in an array (e.g., `[5, 25, 42]`). This array will be passed up to the parent `view.tsx` component.
    2.  **Scrolling:** The component will use `useRef` to get a reference to the main scrollable container. When a "scroll to line" prop is received from the parent, a `useEffect` will trigger that finds the corresponding line element and calls `.scrollIntoView()`.
-   **UI & State (`view.tsx`):**
    1.  **State:** New state variables will be added: `const [diffLocations, setDiffLocations] = useState<number[]>([]);` and `const [currentDiffIndex, setCurrentDiffIndex] = useState(-1);`.
    2.  **Buttons:** "Next" and "Previous" buttons will be added to the UI, likely in the `file-content-viewer-header`.
    3.  **Logic:**
        *   The "Next" button will increment `currentDiffIndex` and trigger a scroll to the line number at `diffLocations[newIndex]`.
        *   The "Previous" button will decrement `currentDiffIndex`.