# Artifact A56: DCE - Phase 2 - Advanced Diff Viewer Plan
# Date Created: C120
# Author: AI Model & Curator
# Updated on: C131 (Correct layout to side-by-side main view, add resizer and scroll-lock)

- **Key/Value for A0:**
- **Description:** Details the plan to enhance the integrated diff viewer with a side-by-side layout, fixed-size panes, scroll-locking, and WinMerge-like navigation controls.
- **Tags:** feature plan, phase 2, ui, ux, diff, navigation, side-by-side, scroll-lock

## 1. Overview & Goal

The current diff view is functional but lacks key usability features found in mature diff tools like WinMerge. The goal of this plan is to enhance the diff viewer to provide a much clearer and more efficient user experience. This involves several key enhancements:
1.  **Side-by-Side Main Layout:** Displaying the original and modified files in two parallel, vertical panes.
2.  **Top-and-Bottom Detail Layout:** Displaying the character-level diff in two panes stacked vertically at the bottom.
3.  **Resizable Panes:** Allowing the user to drag the dividers between the main view and detail view, and between the two main panes.
4.  **Scroll-Locking:** Synchronizing the scroll position of the two main panes and the two detail panes.
5.  **Fixed-Size Panes:** The panes will be internally scrollable and will not resize with their content.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-DIFF-01 | **Side-by-Side Diffs** | As a developer, I want to see a side-by-side view of the original and modified code with a colored background for changed lines, so I can immediately identify changes at a glance. | - The main diff view is split into two vertical panes: "Original" on the left, "AI Response" on the right. <br> - Lines are colored appropriately for additions and removals. |
| P2-DIFF-02 | **Fixed-Size Panes** | As a developer, I want the diff panes to remain a constant size when I navigate between differences, so the UI controls do not move around. | - Each diff pane has a defined `flex-basis`. <br> - If the code content exceeds the pane's height, a vertical scrollbar appears *within* that pane. |
| P2-DIFF-03 | **Navigate Between Diffs** | As a developer reviewing a large file, I want "Next Difference" and "Previous Difference" buttons, so I can quickly jump between changed blocks without the buttons moving. | - "Next Difference" (`↓`) and "Previous Difference" (`↑`) buttons are located in a stable toolbar. <br> - Clicking scrolls the view to the start of the next/previous block of changes and highlights it. |
| P2-DIFF-04 | **Scroll-Locking** | As a developer, when I scroll one of the main diff panes vertically, I want the other main pane to scroll with it, so I can keep the corresponding code aligned. | - The two main diff panes are scroll-locked vertically. <br> - The two bottom detail panes are scroll-locked horizontally. <br> - Each pair of panes has only one visible scrollbar. |
| P2-DIFF-05 | **Resizable Panes** | As a developer, I want to be able to drag the divider between the main diff view and the bottom detail view, so I can allocate more or less space to each section based on my needs. | - A horizontal resizer allows the user to change the vertical space allocated to the main diff view vs. the bottom detail view. |

## 3. Technical Implementation Plan

### 3.1. Layout (`DiffViewer.tsx`, `view.scss`)
-   **Main View:** The main container (`.diff-viewer-main-container`) will have `flex-direction: row` to place the two `.diff-pane` elements side-by-side.
-   **Detail View:** The detail pane container (`.diff-detail-panes`) will have `flex-direction: column` to stack the two `.diff-detail-pane` elements vertically.
-   **Fixed Panes:** All panes will use CSS properties like `flex-basis`, `min-height: 0`, `min-width: 0`, and `overflow: auto` to enforce fixed, internally scrollable behavior.

### 3.2. Scroll-Locking (`DiffViewer.tsx`)
-   Use `useRef` to create references to the scrollable `div` elements for each of the four panes.
-   Add `onScroll` event handlers to the panes.
-   The handler for the left main pane will programmatically set `rightPaneRef.current.scrollTop = leftPaneRef.current.scrollTop`. The right pane's handler will do the inverse. This creates a two-way binding.
-   A similar logic will be applied for the `scrollLeft` property of the two bottom detail panes.
-   CSS will be used to hide the scrollbar on the "follower" pane in each pair.

### 3.3. Horizontal Resizer (`DiffViewer.tsx`)
-   A new state variable will be added to manage the height percentage of the main diff container.
-   A horizontal resizer `div` will be placed between the main container and the detail container.
-   `onMouseDown`, `onMouseMove`, and `onMouseUp` event handlers will be used to track the drag gesture and update the height state, similar to the existing vertical resizer.