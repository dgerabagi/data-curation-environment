# Artifact A105: DCE - PCPP View Refactoring Plan for Cycle 76
# Date Created: C76
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** Provides a detailed plan for refactoring the monolithic `parallel-copilot.view/view.tsx` component into smaller, more manageable sub-components to improve maintainability and reduce token count.
- **Tags:** plan, refactor, architecture, technical debt, pcpp

## 1. Problem Statement

The `parallel-copilot.view/view.tsx` component has grown to over 9,000 tokens, making it a "god component." It manages state and renders logic for numerous distinct features, including cycle navigation, context inputs, response tabs, the workflow toolbar, and the conditional rendering of the onboarding view, progress display, and main response pane. This complexity makes the component difficult to maintain, prone to bugs (like the recent navigation failure), and inefficient to include in AI prompts.

## 2. Refactoring Goals

1.  **Improve Readability & Maintainability:** Break the component into smaller, single-responsibility components.
2.  **Isolate State:** Co-locate state with the components that use it wherever possible.
3.  **Reduce Token Count:** Significantly reduce the token count of the main `view.tsx` file.

## 3. Proposed Refactoring Plan

The main `view.tsx` file will be refactored into a "container" component. Its primary role will be to manage the top-level state (like the `currentCycle` object) and the IPC message handlers. It will then pass slices of this state and callback functions as props to smaller, more focused "presentational" components.

### 3.1. New Component Structure & Token Estimates

This is the proposed breakdown of the existing `view.tsx` functionality into new or existing components within `src/client/views/parallel-copilot.view/components/`.

| Component | Responsibility | Estimated Tokens |
| :--- | :--- | :--- |
| **`view.tsx` (Container)** | - Manages `currentCycle`, `maxCycle`, `tabs` state. <br> - Handles all IPC messages. <br> - Orchestrates rendering of child components. | **~2,500** |
| **`CycleNavigator.tsx`** | - Renders the cycle navigation bar, title input, and management buttons. | **~850** |
| **`ContextInputs.tsx`** | - Renders the "Cycle Context" and "Ephemeral Context" text areas. | **~750** |
| **`ResponseTabs.tsx`** | - Renders the main tab bar and sort button. | **~950** |
| **`WorkflowToolbar.tsx`** | - Renders the centralized workflow buttons (Parse, Select, Baseline, etc.). | **~1,000** |
| **`ResponsePane.tsx`** | - Renders the content of the active tab, conditionally showing either the raw `textarea` or the `ParsedView`. | **~800** |
| **`ParsedView.tsx`** | - Renders the complex multi-pane view for a parsed response. | **~2,500** |
| **`GenerationProgressDisplay.tsx`** | - Renders the UI for streaming responses. | **~2,000** |
| **`OnboardingView.tsx`** | - Renders the initial project setup view for Cycle 0. | **~1,500** |

### 3.2. Implementation Steps (For a Future Cycle)

1.  **Prop Drilling:** Begin by identifying all state and handler functions in `view.tsx` that can be passed down as props to the existing components (`CycleNavigator`, `ContextInputs`, etc.).
2.  **Component Creation:** Create new component files for any logic that is not already in a separate component (e.g., the main conditional rendering logic could be moved to a `MainContent.tsx` component).
3.  **State Lifting/Co-location:** Review the state variables. While the main `currentCycle` object should remain in the container, UI-specific state (like the collapsed state of a section) can be moved into the relevant child component.
4.  **Cleanup:** Once the logic is successfully moved and props are passed correctly, remove the now-redundant rendering logic from `view.tsx`, significantly reducing its size.

## 4. Benefits

-   **Reduced `view.tsx` Size:** The token count of `view.tsx` will be reduced from over 9,000 to approximately 2,500, making it much easier to work with.
-   **Improved Maintainability:** Bugs will be easier to isolate. For example, a bug in the cycle navigator will now be located entirely within `CycleNavigator.tsx`.
-   **Clearer Data Flow:** The use of props will make the flow of data and events through the application more explicit and easier to trace.