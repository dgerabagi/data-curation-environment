# Artifact A61: DCE - Phase 2 - Cycle History Management Plan
# Date Created: C152
# Author: AI Model & Curator
# Updated on: C160 (Add UI placeholders for buttons)

- **Key/Value for A0:**
- **Description:** Outlines the plan to allow users to save and load their entire cycle history (`dce_history.json`), enabling them to manage multiple development threads or back up their work.
- **Tags:** feature plan, phase 2, history, import, export, cycle management

## 1. Overview & Goal

The `dce_history.json` file is a valuable asset that captures the entire iterative development process for a project. Users may want to work on different feature branches or experiments, each with its own cycle history. The goal of this feature is to provide commands and UI controls to export the current cycle history to a file and import a history file, effectively allowing users to save and load different "cycle chains."

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-CHM-01 | **Export Cycle History** | As a developer, I want to export the entire cycle history to a named JSON file, so I can create a backup or save the history for a specific feature branch before starting a new one. | - A "Save History..." button is available in the cycle navigator toolbar. <br> - Executing it opens a "Save As..." dialog. <br> - The current content of `dce_history.json` is written to the user-specified file. |
| P2-CHM-02 | **Import Cycle History** | As a developer, I want to import a cycle history from a JSON file, so I can switch between different development threads or restore a backup. | - A "Load History..." button is available in the cycle navigator toolbar. <br> - Executing it opens an "Open..." dialog to select a JSON file. <br> - The content of the selected file overwrites the current `dce_history.json`. <br> - The PCPP UI automatically refreshes to show the new, imported history. |

## 3. Technical Implementation Plan

1.  **IPC Channels:**
    *   `ClientToServerChannel.RequestExportHistory`: No payload.
    *   `ClientToServerChannel.RequestImportHistory`: No payload.

2.  **Backend (`history.service.ts`):**
    *   **`handleExportHistory()`:**
        *   Read the current `dce_history.json` file.
        *   Use `vscode.window.showSaveDialog` to get a destination URI from the user.
        *   If a URI is provided, write the history content to that file.
    *   **`handleImportHistory()`:**
        *   Use `vscode.window.showOpenDialog` to get a source URI from the user.
        *   If a URI is provided, read its content.
        *   Validate that the content is a valid `PcppHistoryFile`.
        *   Overwrite the workspace's `dce_history.json` with the new content.
        *   Trigger a `ForceRefresh` message to the PCPP frontend.

3.  **Frontend (`view.tsx`):**
    *   Add "Save History" and "Load History" buttons/icons to the cycle navigator toolbar.
    *   Initially, these buttons can be present but disabled, to be fully implemented in a subsequent cycle.
    *   The `onClick` handlers will trigger the corresponding IPC messages.