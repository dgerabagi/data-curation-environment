# Artifact A65: DCE - Universal Task Checklist
# Date Created: C165
# Author: AI Model & Curator
# Updated on: C21 (Add new tasks from playtest feedback)

## 1. Purpose

This artifact provides a structured, universal format for tracking development tasks, feedback, and bugs. Unlike cycle-specific trackers, this checklist organizes work by the group of files involved in a given task. It also introduces a simple complexity metric based on the total token count of the affected files and an estimation of whether the task will require more than one development cycle to complete.

This file-centric approach helps in planning and prioritizing work, especially in an AI-assisted development workflow where context size (token count) is a primary constraint.

## 2. How to Use

-   **Group by File Packages:** Create a new `##` section for each logical task or feature. List all the files that are expected to be modified for this task.
-   **Assign an ID:** Give each task package a unique, simple ID (e.g., `T-1`, `T-2`) for easy reference in feedback.
-   **Estimate Complexity:**
    -   Calculate the **Total Tokens** for all files in the package. This gives a quantitative measure of the context size.
    -   Estimate if the task is likely to take **More than one cycle?**. This is a qualitative judgment based on the complexity of the changes required.
-   **List Action Items:** Under each file package, create a checklist of specific actions, bugs to fix, or features to implement.
-   **Add Verification Steps:** After the action items, add a section describing how the curator should test the feature to confirm it is working as expected.
-   **Note on Output Length:** Remember that the maximum output length for a single response is approximately 65,000 tokens. Do not prematurely stop generating files; attempt to complete as many full files as possible within this limit.
-   **Keep it Current:** At the beginning of each new cycle, review and update this checklist. Move completed tasks to a "Completed" section, add new tasks based on feedback, and re-prioritize as needed. This ensures the checklist remains a living, accurate reflection of the project's status.

---

## Task List for Cycle 21+

## T-1: Fix UI Regressions and Minor Bugs
- **Files Involved:**
    - `src/client/views/parallel-copilot.view/view.scss`
    - `src/backend/services/file-tree.service.ts`
- **Total Tokens:** ~8,800
- **More than one cycle?** No

- [X] **Task (T-ID: 1.1):** Restore the correct theme/style for the "Sort" button so it matches other workflow buttons.
- [X] **Task (T-ID: 1.2):** Add the `.next` directory to the `NON_SELECTABLE_PATTERNS` to exclude it from selection.

### Verification Steps
1.  Launch the extension and open the PCPP. Parse a response.
2.  **Expected:** The "Sort" button in the response tab bar should have the same visual style as the buttons in the main workflow toolbar below it.
3.  Open a project that contains a `.next` build directory.
4.  **Expected:** The `.next` directory in the File Tree View should have a disabled/grayed-out checkbox and should not be selectable.

## T-2: Restore "Select All" Buttons for Associated Files
- **Files Involved:**
    - `src/Artifacts/A86. DCE - PCPP Workflow Centralization and UI Persistence Plan.md`
    - `src/client/views/parallel-copilot.view/components/WorkflowToolbar.tsx`
    - `src/client/views/parallel-copilot.view/view.tsx`
- **Total Tokens:** ~10,000
- **More than one cycle?** No

- [X] **Task (T-ID: 2.1):** Re-add the "Select All" and "Deselect All Across All Responses" buttons to the `WorkflowToolbar`.
- [X] **Task (T-ID: 2.2):** Implement the `handleSelectAllAssociatedFiles` logic. It must select all files in the *active* tab.
- [X] **Task (T-ID: 2.3):** Ensure the "Select All" logic also de-selects any other instance of the same file path from other response tabs to prevent conflicts.
- [X] **Task (T-ID: 2.4):** Update `A86` to reflect that these buttons are being restored.

### Verification Steps
1.  Parse multiple responses where two or more responses modify the same file (e.g., `src/main.ts`).
2.  Manually check the box for `src/main.ts` in `Resp 2`.
3.  Navigate to `Resp 1`. Click the new "Select All" button.
4.  **Expected:** All files in `Resp 1` should become checked. The checkbox for `src/main.ts` in `Resp 2` should become unchecked.
5.  Click "Deselect All Across All Responses".
6.  **Expected:** All checkboxes in all response tabs should become unchecked.

## T-3: Fix File Duplication Bug
- **Files Involved:**
    - `src/Artifacts/A11. DCE - Regression Case Studies.md`
    - `src/backend/services/flattener.service.ts`
    - `src/client/components/file-tree/FileTree.utils.ts`
- **Total Tokens:** ~8,000
- **More than one cycle?** No

- [ ] **Task (T-ID: 3.1):** Add a safeguard in `flattener.service.ts` to de-duplicate the incoming file path list using a `Set`.
- [ ] **Task (T-ID: 3.2):** Fix the root cause in `FileTree.utils.ts` to ensure unchecking the root directory correctly removes all descendant files from the selection state.
- [ ] **Task (T-ID: 3.3):** Create a new regression case study in `A11` for this bug.

### Verification Steps
1.  Check the root directory checkbox. Note the number of selected items.
2.  Uncheck the root directory checkbox.
3.  **Expected:** The "Selected Items" count should drop to 0.
4.  Re-check the root directory checkbox.
5.  **Expected:** The "Selected Items" count should return to the original number, with no duplicates.
6.  Click "Flatten Context" and inspect `flattened_repo.md`.
7.  **Expected:** The file list and content should contain no duplicate file paths.

## T-4: Enhance Onboarding View & Animation Persistence
- **Files Involved:**
    - `src/client/views/parallel-copilot.view/OnboardingView.tsx`
    - `src/client/views/parallel-copilot.view/view.tsx`
- **Total Tokens:** ~9,500
- **More than one cycle?** No

- [X] **Task (T-ID: 4.1):** In `OnboardingView.tsx`, add a `<label>` or `<h3>` with the title "Project Scope" above the main text area.
- [-] **Task (T-ID: 4.2):** Integrate the `SaveStatusIndicator` component into the `OnboardingView` to show save status.
- [X] **Task (T-ID: 4.3):** In `view.tsx`, add a call to `saveCurrentCycleState()` inside the `visibilitychange` event listener to ensure the latest `workflowStep` is persisted when the user switches tabs.

### Verification Steps
1.  Start the extension in a fresh workspace to trigger the onboarding view.
2.  **Expected:** The view should now have a title above the text area, and the save status indicator should be visible.
3.  Proceed to the main PCPP view. Advance the workflow until "Generate prompt.md" is highlighted. Click it. The view will switch to the editor.
4.  Immediately switch back to the PCPP view.
5.  **Expected:** The highlight should now be on the `+` (New Cycle) button, and should not have reverted to "Generate prompt.md".