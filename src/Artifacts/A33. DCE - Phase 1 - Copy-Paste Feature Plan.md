# Artifact A33: DCE - Phase 1 - Copy-Paste Feature Plan
# Date Created: C68
# Author: AI Model

- **Key/Value for A0:**
- **Description:** Details the requirements and implementation for copying and pasting files and folders within the DCE file tree using standard keyboard shortcuts (Ctrl+C, Ctrl+V).
- **Tags:** feature plan, copy, paste, file operations, keyboard shortcuts, ux, phase 1

## 1. Overview & Goal

To achieve greater feature parity with the native VS Code Explorer and enhance user workflow, this plan outlines the implementation of copy (`Ctrl+C`) and paste (`Ctrl+V`) functionality for files and folders directly within the Data Curation Environment view. The goal is to provide a fast and intuitive method for duplicating project assets without leaving the extension.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| CP-01 | **Copy File/Folder** | As a user, I want to press `Ctrl+C` on a focused file or folder in the DCE tree, so I can prepare to create a duplicate of it. | - When a file or folder has keyboard focus, pressing `Ctrl+C` (or `Cmd+C`) stores its path in an internal "clipboard". <br> - There is no immediate visual feedback, mirroring native explorer behavior. |
| CP-02 | **Paste File/Folder** | As a user, after copying a file/folder, I want to press `Ctrl+V` on a target location to paste a copy of it, so I can quickly scaffold new components or back up files. | - Pressing `Ctrl+V` (or `Cmd+V`) triggers the paste operation. <br> - If a folder is focused, the copied item is pasted inside that folder. <br> - If a file is focused, the copied item is pasted into that file's parent directory. <br> - The pasted item is given a unique name (e.g., `original-copy.ts`, `folder-copy (2)`). <br> - Pasting a folder recursively copies all of its contents. <br> - The file tree automatically refreshes to show the newly created item(s). |

## 3. Technical Implementation Plan

1.  **State Management (Frontend - `view.tsx`):**
    *   A new state variable will be introduced to act as the internal clipboard: `const [copiedPath, setCopiedPath] = useState<string | null>(null);`.

2.  **IPC Channels:**
    *   A new channel will be created: `ClientToServerChannel.RequestCopyFile`.
    *   Its payload will be `{ sourcePath: string, targetPath: string }`.

3.  **Keyboard Event Handling (Frontend - `TreeView.tsx`):**
    *   The `handleKeyDown` function will be updated to handle `Ctrl+C` and `Ctrl+V` (and `Cmd` for Mac).
    *   **On `Ctrl+C`:** It will call a new prop function, `onCopyNode(focusedNodePath)`. In `view.tsx`, this will simply call `setCopiedPath(path)`.
    *   **On `Ctrl+V`:** It will call a new prop function, `onPasteNode(focusedNodePath)`. In `view.tsx`, this function will check if `copiedPath` is set. If it is, it will send the `RequestCopyFile` message to the backend.

4.  **Backend Logic (`fs.service.ts`):**
    *   A new public method, `handleCopyFileRequest`, will be created to handle the IPC message.
    *   **Determine Destination:** The method will first parse the `targetPath` to determine the final destination directory.
    *   **Generate Unique Name:** A private helper function, `_findUniqueName(destinationPath)`, will be implemented. It will check if a file or folder at `destinationPath` exists. If it does, it will append suffixes like `-copy`, ` (2)`, ` (3)`, etc., until an unused name is found.
    *   **Perform Copy:** It will use `vscode.workspace.fs.copy(sourceUri, uniqueDestinationUri)`. The `copy` API natively handles recursive copying for directories.
    *   The existing file watcher will detect the creation of the new file/folder and trigger a UI refresh automatically.