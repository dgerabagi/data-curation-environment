# Artifact A43: DCE - Phase 2 - Implementation Roadmap
# Date Created: C72
# Author: AI Model

- **Key/Value for A0:**
- **Description:** Provides a step-by-step implementation plan for building the Phase 2 features, including the Parallel Co-Pilot panel and the integrated Diff Tool.
- **Tags:** feature plan, phase 2, roadmap, project plan, diff tool

## 1. Overview & Goal

This document provides a clear, step-by-step roadmap for the implementation of Phase 2. The scope of Phase 2 is now defined as the **Parallel Co-Pilot Panel with an integrated Diff Tool**. This roadmap breaks the large feature set into smaller, manageable, and testable steps. The goal is to build the functionality incrementally, ensuring a stable foundation at each stage.

## 2. Implementation Steps

### Step 1: Foundational UI & State

-   **Goal:** Create the static, non-functional UI for the Parallel Co-Pilot panel.
-   **Tasks:**
    1.  **Scaffolding:** Run the `deploy_phase2_scaffold.js` script from `A42`.
    2.  **Configuration:**
        *   Update `package.json` to add the new `parallelCopilot` view to `contributes.views`.
        *   Update `webpack.config.js` to add the new `parallelCopilotView` entry point.
        *   Update `services.ts` to instantiate and provide the new `HistoryService`.
    3.  **UI Development (`view.tsx`):** Build the static React components for the panel based on the mockup in `A35`, including the tab bar, slider for tab count, metadata display table, and action buttons.
-   **Outcome:** A visible but non-interactive panel that renders the basic layout.

### Step 2: Core "Swap" Functionality

-   **Goal:** Implement the primary "Swap with Source" feature.
-   **Tasks:**
    1.  **IPC Channels:** Define the `RequestSwapFileContent` and related channels as specified in `A36`.
    2.  **Backend (`fs.service.ts`):** Implement the `handleSwapFileContentRequest` method, which reads the original file content and overwrites it with the new content from the tab.
    3.  **Frontend (`view.tsx`):** Wire up the "Swap with Source" button's `onClick` handler to send the IPC message and handle the response (placing the original content back into the tab).
-   **Outcome:** The user can paste code into a tab, click "Swap," and see the file on disk update, confirming the core workflow is functional.

### Step 3: API Key Management & Settings

-   **Goal:** Implement the UI and backend for managing API keys and local LLM URLs.
-   **Tasks:**
    1.  Follow the technical plan in `A41. DCE - Phase 2 - API Key Management - Feature Plan`.
    2.  Create a new `SettingsService` on the backend.
    3.  Create a new command and webview for the settings UI.
    4.  Implement logic to securely store API keys using `SecretStorage`.
-   **Outcome:** Users can securely save their API keys and configure a local model endpoint, preparing for live AI integration.

### Step 4: Basic Diffing Integration

-   **Goal:** Integrate a simple diff view to compare a response with the source file.
-   **Tasks:**
    1.  **Add Dependency:** Add a lightweight diffing library (e.g., `diff`) to `package.json`.
    2.  **UI (`view.tsx`):** Add a "Diff" button to each tab.
    3.  **Component (`DiffViewer.tsx`):** Create a new component that takes two strings (original and new) as props and renders them in a side-by-side or inline diff view.
    4.  **Workflow:** Clicking the "Diff" button will fetch the original source content and render the `DiffViewer` component within the tab or in a modal.
-   **Outcome:** The user can see a clear, color-coded comparison of changes proposed by an AI response without leaving the panel.

### Step 5: Cycle Navigator & History

-   **Goal:** Implement the ability to save and navigate through past cycles.
-   **Tasks:**
    1.  Follow the technical plan in `A39. DCE - Phase 2 - Cycle Navigator - Technical Plan`.
    2.  **Backend (`history.service.ts`):** Implement the logic to read and write to the `dce_history.json` file.
    3.  **Frontend (`view.tsx`):** Build the UI controls for navigating cycles (`<`, `>`, cycle number). Implement the state management to load historical response data into the tabs when the user navigates.
-   **Outcome:** The extension now has a persistent memory, allowing users to review the entire history of their AI-driven development process.

### Step 6: Live API Integration (Becomes new Phase 3)

-   **Goal:** Connect the panel to live LLM APIs.
-   **Tasks:**
    1.  Create a new `LlmService` or extend an existing one to handle API calls.
    2.  Use the configured API keys/URL from Step 3.
    3.  Add a "Generate" or "Run Prompt" button that sends the current prompt and context to the selected LLM and streams the response back into a tab.
-   **Outcome:** The DCE becomes a fully-featured, end-to-end AI development environment.