# Artifact A77: DCE - Monaco Editor Replacement Plan
# Date Created: C182
# Author: AI Model & Curator
# Updated on: C183 (Reflect correct implementation with prism-react-renderer)

- **Key/Value for A0:**
- **Description:** Documents the failure of the Monaco Editor integration and the new plan to switch to a lighter-weight, non-worker-based editor component.
- **Tags:** plan, refactor, ui, ux, monaco, codemirror, technical debt, react-simple-code-editor, prism-react-renderer

## 1. Problem Statement

The attempt to integrate the Monaco Editor (`@monaco-editor/react`) into the Parallel Co-Pilot Panel's context panes (Cycles C179-C182) was a failure. Despite multiple attempts to configure the Webpack plugin and adjust the Content Security Policy (CSP), the editor component remained stuck in a perpetual "Loading..." state.

-   **Symptom:** The "Cycle Context" and "Ephemeral Context" panes displayed a "Loading..." message and were completely non-functional.
-   **Root Cause Analysis (RCA):** The Monaco Editor is a complex component that relies heavily on web workers for its performance and features. The VS Code webview environment has a strict security model (CSP) that makes the setup and bundling of these web workers exceptionally difficult. The "Loading..." state was a direct result of the webview blocking the editor's worker scripts from loading, even with a relaxed CSP. This indicates a fundamental incompatibility between the editor's architecture and the webview's security constraints.

## 2. The Pivot: Prioritizing Stability and Simplicity

A feature-rich but non-functional editor is useless. The new strategy is to pivot away from complex, worker-based editors like Monaco (and likely CodeMirror, which would face similar issues) and adopt a more lightweight and reliable solution that is known to work well within restricted environments.

The new chosen stack is:
1.  **`react-simple-code-editor`**: A very lightweight library that provides the core functionality of a code editor (maintaining indentation, etc.) using a simple `<textarea>` and a `<pre>` overlay. It does not use web workers, completely avoiding the CSP issues.
2.  **`prism-react-renderer`**: A popular, React-focused wrapper around `prismjs`. It provides high-quality syntax highlighting and is designed to be integrated with components like `react-simple-code-editor`.

## 3. Technical Implementation Plan (C183)

1.  **Dependencies (`package.json`):**
    *   **Remove:** `@monaco-editor/react`, `monaco-editor-webpack-plugin`.
    *   **Add:** `react-simple-code-editor`, `prism-react-renderer`, `prismjs`, and `@types/prismjs`.

2.  **Build Configuration (`webpack.config.js`):**
    *   Remove the `MonacoWebpackPlugin` entirely.

3.  **CSP Reversion (`common/utils/view-html.ts`):**
    *   Revert the Content Security Policy to a stricter version, as `worker-src 'blob:'` is no longer needed.

4.  **Component Implementation (`ContextInputs.tsx`):**
    *   The `<Editor>` component from `@monaco-editor/react` will be replaced with the `<Editor>` component from `react-simple-code-editor`.
    *   The `highlight` prop of the new editor will be wired to a function that uses the `<Highlight>` component from `prism-react-renderer`. This is the correct pattern for combining these two libraries.
    *   The component will be configured to use a standard theme (e.g., `themes.vsDark`) and the `markdown` language grammar.

This approach provides the desired Markdown syntax highlighting in a stable, performant, and lightweight component that is compatible with the VS Code webview's security model.