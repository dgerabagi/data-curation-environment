# Artifact A52: DCE - Interaction Schema Refinement
# Date Created: C108
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** Proposes a set of refined rules for the AI's output format to improve the reliability and consistency of automated parsing within the Parallel Co-Pilot Panel.
- **Tags:** documentation, process, parsing, interaction schema, roadmap

## 1. Overview & Goal

The Parallel Co-Pilot Panel (PCPP) relies on parsing the AI's output to provide features like file association, diffing, and syntax highlighting. Analysis of historical cycle data reveals that the AI's output format has drifted over time, using multiple conventions for headers and file blocks. This inconsistency makes the parser complex and brittle.

The goal of this artifact is to define a refined, stricter set of rules for the AI's output. By codifying a canonical format, we make the parser's job simpler and more reliable, improving the overall robustness of the PCPP. This document contains the proposed changes to be integrated into the main `M3. Interaction Schema`.

## 2. Proposed Changes to `M3. Interaction Schema`

### 2.1. Standardized Response Structure

To ensure predictable parsing, all responses must adhere to the following structure and order:

1.  **Summary/Plan:** The response must begin with a high-level summary, thoughts, or plan. This section ends at the first occurrence of a standardized header.
2.  **Course of Action Header:** This section must begin with the exact markdown header: `### Course of Action`.
3.  **Files Updated Header:** This section must begin with the exact markdown header: `### Files Updated This Cycle:`.
4.  **File Blocks:** The response must conclude with the code/document artifact blocks.

### 2.2. Canonical File Block Format

To eliminate ambiguity, all file and document artifacts must be enclosed in the following canonical format:

```xml
<file path="path/to/your/file.ext">
[... file content ...]
</file>
```

**Rules for File Blocks:**
*   The opening tag **must** be `<file path="...">`. The path must be a relative path from the project root, using forward slashes (`/`).
*   The closing tag **must** be `</file>`.
*   Formats where the file path is the tag name (e.g., `<src/main.ts>...`) are now deprecated and should not be used.
*   The surrounding triple-backtick code fences (e.g., ` ```xml ... ``` `) are optional but recommended for readability. The parser will handle their presence or absence.

### 2.3. Standardized "Files Updated" List Format

The list of files under the `### Files Updated This Cycle:` header must follow this format:

```
* `path/to/file.ext` (Status)
```

**Rules for Files Updated List:**
*   Each item must be a markdown list item (starting with `*` or `-`).
*   The file path **must** be enclosed in backticks (`` ` ``).
*   The status (e.g., `(Updated)`, `(New)`, `(Deleted)`) is optional but recommended. The parser will be designed to ignore it.

## 3. Rationale

By enforcing this stricter contract on the AI's output, we significantly reduce the complexity of the `response-parser.ts`. The parser no longer needs multiple, complex regular expressions to account for numerous format variations. This leads to:
*   **Increased Reliability:** Parsing is less likely to fail on subtle format changes.
*   **Improved Maintainability:** The parser code becomes simpler and easier to understand.
*   **Predictable Behavior:** The PCPP's features will behave more consistently across all responses.