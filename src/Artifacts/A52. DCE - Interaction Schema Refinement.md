# Artifact A52: DCE - Interaction Schema Refinement
# Date Created: C110
# Author: AI Model & Curator
# Updated on: C137 (Clarify prompt.md cycle structure)

- **Key/Value for A0:**
- **Description:** Proposes a set of refined rules for the AI's output format to improve the reliability and consistency of automated parsing within the Parallel Co-Pilot Panel.
- **Tags:** documentation, process, parsing, interaction schema, roadmap

## 1. Overview & Goal

The Parallel Co-Pilot Panel (PCPP) relies on parsing the AI's output to provide features like file association, diffing, and syntax highlighting. Analysis of historical cycle data reveals that the AI's output format has drifted over time, using multiple conventions for headers and file blocks. This inconsistency makes the parser complex and brittle.

The goal of this artifact is to define a refined, stricter set of rules for the AI's output. By codifying a canonical format, we make the parser's job simpler and more reliable, improving the overall robustness of the PCPP. This document contains the proposed changes to be integrated into the main `M3. Interaction Schema`.

## 2. Proposed Changes to `M3. Interaction Schema`

### 2.1. Standardized Response Structure

To ensure predictable parsing, all responses must adhere to the following structure and order:

1.  **Summary/Plan:** The response must begin with a high-level summary, thoughts, or plan. This section ends at the first occurrence of a standardized header.
2.  **Course of Action Header:** This section must begin with a markdown header like `### Course of Action`.
3.  **Files Updated Header:** This section must begin with the exact markdown header: `### Files Updated This Cycle:`.
4.  **File Blocks:** The response must conclude with the code/document artifact blocks.
5.  **Duplicate Sections:** If a response contains duplicate standardized sections (e.g., two `### Course of Action` blocks), the parser will **only use the content of the last one**.

### 2.2. Canonical File Block Format

To eliminate ambiguity, all file and document artifacts must be enclosed in the following canonical format:

```xml
<file path="path/to/your/file.ext">
[... file content ...]
</file>
```
*   The opening tag **must** be `<file path="...">`.
*   The closing tag **must** be `</file>`.

### 2.3. Standardized `prompt.md` Cycle Structure (C137)

The `prompt.service.ts` will generate the `<M6. Cycles>` block with the following structure:

*   The block for the **current cycle** will contain the user-provided `<Cycle Context>` and `<Ephemeral Context>`.
*   The block for the **current cycle** will also contain a `<Previous Cycle ... Summary of Actions>` section, which is generated from the response selected in the *previous* cycle.
*   Blocks for **all other historical cycles** will only contain the `<Previous Cycle ... Summary of Actions>` section relevant to them.
*   The `<cycle title>` is **not** part of the `<M6. Cycles>` block; it is only used to generate the `<M2. cycle overview>`.