# Artifact A52: DCE - Interaction Schema Refinement
# Date Created: C110
# Author: AI Model & Curator
# Updated on: C147 (Add detailed parsing logic for "metainterpretability")

- **Key/Value for A0:**
- **Description:** A set of refined rules and an explanation of the parsing logic for the AI's output format to improve the reliability and consistency of automated parsing within the Parallel Co-Pilot Panel.
- **Tags:** documentation, process, parsing, interaction schema, metainterpretability

## 1. Overview & Goal

The Parallel Co-Pilot Panel (PCPP) relies on parsing your output to provide features like file association, diffing, and syntax highlighting. To ensure this process is reliable, your responses must adhere to a strict and consistent format.

The goal of this document is to serve as a definitive guide for you, the AI, on how to structure your responses. It explains the "documentation first" principle we follow and details the exact logic the PCPP parser uses. By understanding how you are being interpreted, you can generate perfectly parsable output every time.

## 2. The "Documentation First" Principle

A core principle of this project is to **plan before coding**.
-   **Cycle 0 (Project Initialization):** Your first task for a new project is **always** to generate planning and documentation artifacts (e.g., A1 Project Vision, A2 Requirements), not code files. You should use the provided templates as a guide.
-   **Subsequent Cycles:** When a new feature is requested, your first step should be to update existing documentation or create new artifacts that describe the plan for that feature. You should only generate code *after* the plan has been documented.

## 3. How the PCPP Parser Works

The parser is designed to be simple and robust. It looks for specific headers and tags to break your response into structured data. Here is the step-by-step logic:

### Step 1: Extract File Blocks

The parser's most important job is to find and extract all file blocks. It does this using a single, precise regular expression.

-   **Rule:** Every file you generate **must** be enclosed in `<file path="..."></file>` tags.
-   **Example:**
    ```xml
    <file path="src/main.ts">
    // ... content of main.ts
    </file>
    ```
-   **Parser Logic:** The parser looks for the literal string `<file path="` followed by a quoted path, then captures everything until it finds the literal closing string `</file>`. **Any other format will be ignored.**

### Step 2: Extract Summary / Plan

The parser assumes everything from the beginning of your response until the first major header is the summary.

-   **Rule:** Your high-level summary, thoughts, or plan must come first.
-   **Parser Logic:** The parser captures all text from the start of the response up to the first occurrence of `### Course of Action` or `### Files Updated This Cycle:`.

### Step 3: Extract Course of Action

-   **Rule:** The "Course of Action" section must begin with the exact markdown header `### Course of Action`.
-   **Parser Logic:** The parser looks for the last occurrence of this header and captures all text following it until it hits the next major header or a file block.

### Step 4: Extract List of Updated Files

-   **Rule:** The list of updated files must begin with the exact markdown header `### Files Updated This Cycle:`.
-   **Parser Logic:** The parser looks for this header and captures the bulleted list that follows. It then extracts file paths primarily from this list if no `<file>` tags were found, but this is a fallback. **The `<file>` tags are the source of truth.**

## 4. Canonical Response Structure

To guarantee successful parsing, every response should follow this structure:

```
[High-level summary and analysis of the request.]

### Course of Action

[A detailed, point-by-point plan of the changes you are about to make.]

### Files Updated This Cycle:
*   `path/to/first/file.ts` (Updated)
*   `path/to/second/file.md` (New)

<file path="path/to/first/file.ts">
// Full content of the first file...
</file>

<file path="path/to/second/file.md">
# Full content of the second file...
</file>