# Artifact A52: DCE - Interaction Schema Refinement
# Date Created: C110
# Author: AI Model & Curator
# Updated on: C147 (Add specific rules for Cycle 0 responses)

- **Key/Value for A0:**
- **Description:** Proposes a set of refined rules for the AI's output format to improve the reliability and consistency of automated parsing within the Parallel Co-Pilot Panel.
- **Tags:** documentation, process, parsing, interaction schema, roadmap

## 1. Overview & Goal

The Parallel Co-Pilot Panel (PCPP) relies on parsing the AI's output to provide features like file association, diffing, and syntax highlighting. Analysis of historical cycle data reveals that the AI's output format has drifted over time, using multiple conventions for headers and file blocks. This inconsistency makes the parser complex and brittle.

The goal of this artifact is to define a refined, stricter set of rules for the AI's output. By codifying a canonical format, we make the parser's job simpler and more reliable, improving the overall robustness of the PCPP. This document contains the proposed changes to be integrated into the main `M3. Interaction Schema`.

## 2. Proposed Changes to `M3. Interaction Schema`

### 2.1. Standardized Response Structure

To ensure predictable parsing, all responses must adhere to the following structure and order:

1.  **Summary/Plan:** The response must begin with a high-level summary, thoughts, or plan. This section ends at the first occurrence of a standardized header.
2.  **Course of Action Header:** This section must begin with a markdown header like `### Course of Action`.
3.  **Files Updated Header:** This section must begin with the exact markdown header: `### Files Updated This Cycle:`.
4.  **File Blocks:** The response must conclude with the code/document artifact blocks.
5.  **Duplicate Sections:** If a response contains duplicate standardized sections (e.g., two `### Course of Action` blocks), the parser will **only use the content of the last one**.

### 2.2. Canonical File Block Format

To eliminate ambiguity, all file and document artifacts must be enclosed in the following canonical format:

```xml
<file path="path/to/your/file.ext">
[... file content ...]
</file>
```
*   The opening tag **must** be `<file path="...">`.
*   The closing tag **must** be `</file>`.

### 2.3. Cycle 0 Response Format (C147 Update)

The initial onboarding response (Cycle 0) has a special set of rules to guide the AI into a "planning first" workflow.

1.  **Role:** The AI's role for Cycle 0 is **Project Architect**.
2.  **Output Type:** The output for Cycle 0 **must** consist of **documentation artifacts**, not code files.
3.  **Artifact Tag Format:** Each documentation artifact must be wrapped in its own XML-style tag, where the tag name is the artifact's filename (e.g., `<A0_Master_Artifact_List.md>...</A0_Master_Artifact_List.md>`).
4.  **Forbidden Tags:** The use of `<file path="...">` tags is **strictly forbidden** in Cycle 0 responses. This ensures the output is treated as planning documentation, not as a code scaffold.

### 2.4. Standardized `prompt.md` Cycle Structure (C138 Update)

The `prompt.service.ts` will generate the `<M6. Cycles>` block with the following precise structure. This is the definitive format.

#### Rules:
1.  The `<M2. cycle overview>` section contains the titles of all cycles, sorted newest to oldest.
2.  The `<M6. Cycles>` section contains the detailed content of each cycle, also sorted newest to oldest.
3.  The **current cycle** is unique: it is the only one that can contain `<Ephemeral Context>`.
4.  For any given `<Cycle N>`, it must contain its own `<Cycle Context>` (if provided) and the `<Previous Cycle N-1 Summary of Actions>`.

#### Example Correct Structure:

```xml
<M6. Cycles>

<Cycle 3>
<Cycle Context>
This is the context I wrote for Cycle 3.
</Cycle Context>
<Ephemeral Context>
This is temporary context for Cycle 3 only.
</Ephemeral Context>
<Previous Cycle 2 Summary of Actions>
This is the summary of the AI response I selected in Cycle 2.
...
</Previous Cycle 2 Summary of Actions>
</Cycle 3>

<Cycle 2>
<Cycle Context>
This is the context I wrote for Cycle 2.
</Cycle Context>
<Previous Cycle 1 Summary of Actions>
This is the summary of the AI response I selected in Cycle 1.
...
</Previous Cycle 1 Summary of Actions>
</Cycle 2>

<Cycle 1>
<Cycle Context>
This is the context I wrote for Cycle 1.
</Cycle Context>
</Cycle 1>

</M6. Cycles>
```