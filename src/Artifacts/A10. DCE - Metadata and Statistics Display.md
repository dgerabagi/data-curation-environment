# Artifact A10: DCE - Metadata and Statistics Display
# Date Created: Cycle 14
# Author: AI Model

- **Key/Value for A0:**
- **Description:** Outlines the requirements and design for displaying live metadata (total selected files, total tokens) and for showing aggregate statistics (token and file counts) for folders in the file tree.
- **Tags:** feature plan, metadata, statistics, token count, ui, ux

## 1. Overview & Goal

To enhance the data curation process, it is critical for the user to have immediate, quantitative feedback on their selections. This feature will provide at-a-glance statistics at both the folder level and the overall selection level. The goal is to empower the user to make informed decisions about context size and composition without needing to perform manual calculations.

## 2. User Stories

| ID | User Story | Acceptance Criteria |
|---|---|---|
| US-01 | **Folder Statistics** | As a data curator, I want to see the total token count and the total number of files contained within each folder, so I can quickly assess the size and complexity of different parts of my project. | - Next to each folder name in the file tree, a token count is displayed. <br> - This token count is the recursive sum of all tokens from all files within that folder and its subfolders. <br> - Next to the token count, a file count (e.g., "[15 files]") is also displayed. <br> - These numbers are calculated on the backend and provided with the initial file tree data. |
| US-02 | **Live Selection Summary** | As a data curator, I want to see a live summary of my total selection as I check and uncheck files, so I can monitor the total size of my context in real-time. | - A dedicated summary panel/footer is visible in the UI. <br> - This panel displays "Selected Files: X" and "Total Tokens: Y". <br> - "X" is the total count of all individual files included in the current selection (resolving selected folders into their constituent files). <br> - "Y" is the sum of all token counts for those selected files. <br> - These values update instantly whenever a checkbox is changed. |
| US-03 | **Readable Numbers** | As a data curator, I want large token counts to be formatted in a compact and readable way (e.g., 1,234 becomes "1.2K", 5,678,901 becomes "5.68M"), so I can easily parse the information. | - All token counts (for files, folders, and the live summary) use K/M/B suffixes for numbers over 1,000. <br> - The number formatting logic from artifact `A189` is used. |

## 3. Technical Implementation Plan

1.  **Backend (`fs.service.ts`):**
    *   The `FileNode` interface in `src/common/types/file-node.ts` will be updated to include `tokenCount: number` and `fileCount: number`.
    *   The `createFileTree` function will be modified to be asynchronous and recursive.
    *   As it traverses the file system to build the tree, it will calculate the token count for each file.
    *   After processing all children of a directory, it will recursively sum their `tokenCount` and `fileCount` values and store them in the parent directory's `FileNode`.

2.  **Frontend - Folder Statistics (`FileTree.tsx`):**
    *   A new utility file, `src/common/utils/formatting.ts`, will be created to house the `formatLargeNumber` function.
    *   The `FileTree.tsx` component will be updated to render the `tokenCount` and `fileCount` properties from the `FileNode` data.
    *   It will import and use `formatLargeNumber` to display the `tokenCount` for both files and folders.

3.  **Frontend - Live Summary Panel (`context-chooser.view.tsx`):**
    *   A new UI section (e.g., a `div` in the header or a new footer) will be added to the main view component.
    *   A `useMemo` or `useEffect` hook will be used to watch for changes in the `selectedFiles` state array and the main `files` tree data.
    *   A new client-side utility function will be created. This function will take the `selectedFiles` array and the full `files` tree as input. It will traverse the tree, identify all individual file paths that fall under the selected paths, and sum their token counts and file counts.
    *   The results of this calculation will be stored in a local state and rendered in the new summary panel. The `formatLargeNumber` utility will be used for the total token display.