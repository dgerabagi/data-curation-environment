# Artifact A74: DCE - Per-Input Undo-Redo Feature Plan
# Date Created: C177
# Author: AI Model & Curator

- **Key/Value for A0:**
- **Description:** A plan to implement a separate undo/redo history for each major text input in the PCPP to provide a more intuitive editing experience.
- **Tags:** feature plan, ui, ux, undo, redo, state management

## 1. Overview & Goal

Currently, all text inputs in the Parallel Co-Pilot Panel (e.g., Cycle Title, Cycle Context, Ephemeral Context) share a single, global undo/redo history stack, which is the default behavior for a webview. This leads to a confusing and non-standard user experience. For example, typing in the "Cycle Context" and then pressing `Ctrl+Z` in the "Cycle Title" input will undo the change made in the context field, not the title field.

The goal of this feature is to implement a separate, independent undo/redo history for each major text input, aligning the panel's behavior with standard application design.

## 2. User Story

| ID | User Story | Acceptance Criteria |
|---|---|---|
| P2-UNDO-01 | **Per-Input Undo/Redo** | As a developer, when I am editing multiple text fields, I want `Ctrl+Z` (Undo) and `Ctrl+Y` (Redo) to apply only to the text field I am currently focused on, so I can manage my edits for each field independently. | - Changes made to the "Cycle Title" input can be undone/redone without affecting the other text areas. <br> - Changes made to the "Cycle Context" text area can be undone/redone independently. <br> - Changes made to the "Ephemeral Context" text area can be undone/redone independently. |

## 3. Technical Implementation Plan

This is a complex feature that requires overriding the browser's default undo/redo behavior and implementing a custom state management solution.

1.  **Create a Custom `useHistoryState` Hook:**
    *   A new React hook, `useHistoryState`, will be created to manage the state history for a single value (e.g., a string).
    *   This hook will manage a state object: `{ past: string[], present: string, future: string[] }`.
    *   It will return an array: `[state, setState, undo, redo, canUndo, canRedo]`.
    *   The `setState` function will update the `present` value and push the old `present` value onto the `past` stack.
    *   The `undo` and `redo` functions will move values between the `past`, `present`, and `future` stacks.

2.  **Integrate the Hook in `view.tsx`:**
    *   The main `view.tsx` component will use this custom hook for each of the relevant state variables:
        ```typescript
        const [cycleTitle, setCycleTitle, undoTitle, redoTitle] = useHistoryState('');
        const [cycleContext, setCycleContext, undoContext, redoContext] = useHistoryState('');
        const [ephemeralContext, setEphemeralContext, undoContext, redoContext] = useHistoryState('');
        ```

3.  **Implement Custom `onKeyDown` Handlers:**
    *   A new `onKeyDown` handler will be created and attached to each of the relevant input/textarea components.
    *   This handler will check for `Ctrl+Z` and `Ctrl+Y` (and their platform-specific variants).
    *   When an undo/redo shortcut is detected, it will call `event.preventDefault()` to stop the default browser action.
    *   It will then call the corresponding `undo` or `redo` function from the `useHistoryState` hook for that specific input.

4.  **Refactor `NumberedTextarea.tsx`:**
    *   The `NumberedTextarea` component will need to be updated to accept the new, more complex `onKeyDown` handler.

This approach will provide the robust, per-input undo/redo functionality required for a professional user experience.